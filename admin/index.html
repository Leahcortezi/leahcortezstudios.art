<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Admin - Leah Cortez Studios</title>
    <style>
        :root {
            --color-primary: #2c1810;
            --color-secondary: #8b4513;
            --color-accent: #d4af37;
            --color-background: #0a0a0a;
            --color-text: #f5f5dc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: var(--color-background);
            color: var(--color-text);
            min-height: 100vh;
            padding: 20px;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .admin-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: var(--color-primary);
            border-radius: 10px;
        }

        .admin-header h1 {
            color: var(--color-accent);
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .admin-section {
            background: var(--color-primary);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .section-title {
            color: var(--color-accent);
            font-size: 1.5rem;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--color-accent);
            padding-bottom: 10px;
        }

        .submission-form {
            display: grid;
            gap: 15px;
            background: rgba(139, 69, 19, 0.2);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 10px;
            align-items: center;
        }

        .form-row label {
            font-weight: bold;
            color: var(--color-accent);
        }

        .form-row input, .form-row textarea, .form-row select {
            padding: 8px;
            border: 1px solid var(--color-secondary);
            border-radius: 4px;
            background: var(--color-background);
            color: var(--color-text);
        }

        .form-row textarea {
            resize: vertical;
            min-height: 60px;
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            border: 2px solid var(--color-secondary);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-approve {
            background: #28a745;
            color: white;
        }

        .btn-approve:hover {
            background: #1e7e34;
        }

        .btn-reject {
            background: #dc3545;
            color: white;
        }

        .btn-reject:hover {
            background: #c82333;
        }

        .btn-save {
            background: var(--color-accent);
            color: var(--color-primary);
        }

        .btn-save:hover {
            background: #b8941f;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-pending {
            background: #ffc107;
            color: #212529;
        }

        .status-approved {
            background: #28a745;
            color: white;
        }

        .status-rejected {
            background: #dc3545;
            color: white;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--color-accent);
            color: var(--color-primary);
            border-radius: 8px;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .quick-add {
            background: rgba(212, 175, 55, 0.1);
            border: 2px dashed var(--color-accent);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .quick-add h3 {
            color: var(--color-accent);
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>🎨 Community Admin Panel</h1>
            <p>Manage artwork submissions and community showcase</p>
        </div>

        <!-- API Management Section -->
        <div class="admin-section">
            <h2 class="section-title">Email Approval API</h2>
            <div style="background: rgba(212, 175, 55, 0.1); border: 2px solid var(--color-accent); border-radius: 10px; padding: 20px;">
                <h3 style="color: var(--color-accent); margin-bottom: 15px;">🚀 Automated Email Approval System</h3>
                <p style="margin-bottom: 15px;">Reply "APPROVE" to submission emails to automatically add artwork to showcase!</p>
                
                <div style="display: grid; gap: 15px;">
                    <div class="form-row">
                        <label>API Status:</label>
                        <button onclick="testAPI()" class="btn btn-save">Test API Connection</button>
                    </div>
                    <div class="form-row">
                        <label>Approved Artworks:</label>
                        <button onclick="viewApprovedArtworks()" class="btn btn-save">View All Approved</button>
                    </div>
                    <div class="form-row">
                        <label>Refresh Showcase:</label>
                        <button onclick="refreshCommunityShowcase()" class="btn btn-save">Refresh Community Page</button>
                    </div>
                    <div class="form-row">
                        <label>API Logs:</label>
                        <button onclick="viewAPILogs()" class="btn btn-save">View Activity Log</button>
                    </div>
                </div>
                
                <div id="apiResults" style="margin-top: 20px; padding: 15px; background: var(--color-background); border-radius: 8px; display: none;">
                    <h4 style="color: var(--color-accent);">API Response:</h4>
                    <pre id="apiResponseText" style="color: var(--color-text); font-size: 0.9rem; white-space: pre-wrap;"></pre>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(139, 69, 19, 0.2); border-radius: 8px;">
                    <h4 style="color: var(--color-accent); margin-bottom: 10px;">Setup Instructions:</h4>
                    <ol style="color: var(--color-text); line-height: 1.6;">
                        <li>Set up Zapier/Make.com webhook (see <code>/api/README.md</code>)</li>
                        <li>Configure email parsing to extract submission details</li>
                        <li>Test with manual API call below</li>
                        <li>Reply "APPROVE" to any submission email to activate</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Manual API Test Section -->
        <div class="admin-section">
            <h2 class="section-title">Manual API Test</h2>
            <div class="quick-add">
                <h3>Test Email Approval Workflow</h3>
                <p>Test the API that Zapier/Make.com will use when you reply "APPROVE"</p>
                <form id="apiTestForm" class="submission-form">
                    <div class="form-row">
                        <label>Artist Name*:</label>
                        <input type="text" id="apiArtistName" value="Test Artist" required>
                    </div>
                    <div class="form-row">
                        <label>Artwork Title*:</label>
                        <input type="text" id="apiArtworkTitle" value="Test API Artwork" required>
                    </div>
                    <div class="form-row">
                        <label>Description:</label>
                        <textarea id="apiDescription">Test artwork submitted via API</textarea>
                    </div>
                    <div class="form-row">
                        <label>Medium:</label>
                        <select id="apiMedium">
                            <option value="digital">Digital Art</option>
                            <option value="traditional">Traditional Art</option>
                            <option value="mixed-media">Mixed Media</option>
                            <option value="photography">Photography</option>
                            <option value="sculpture">Sculpture</option>
                            <option value="textile">Textile Art</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label>Category:</label>
                        <select id="apiCategory">
                            <option value="daily-prompt">Daily Prompt Response</option>
                            <option value="personal">Personal Work</option>
                            <option value="commission">Commission Work</option>
                            <option value="study">Study/Practice</option>
                            <option value="collaboration">Collaboration</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label>Image URL*:</label>
                        <input type="url" id="apiImageUrl" value="https://picsum.photos/400/400" required>
                    </div>
                    <div class="action-buttons">
                        <button type="submit" class="btn btn-approve">Test API Call</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Quick Add Section -->
        <div class="admin-section">
            <h2 class="section-title">Quick Add Artwork</h2>
            <div class="quick-add">
                <h3>Manual Artwork Addition</h3>
                <p>Add artwork directly to the showcase from email submissions or other sources</p>
                <form id="quickAddForm" class="submission-form">
                    <div class="form-row">
                        <label>Artist Name*:</label>
                        <input type="text" id="quickArtistName" required>
                    </div>
                    <div class="form-row">
                        <label>Artwork Title*:</label>
                        <input type="text" id="quickArtworkTitle" required>
                    </div>
                    <div class="form-row">
                        <label>Description:</label>
                        <textarea id="quickDescription" placeholder="Brief description..."></textarea>
                    </div>
                    <div class="form-row">
                        <label>Medium:</label>
                        <select id="quickMedium">
                            <option value="digital">Digital Art</option>
                            <option value="traditional">Traditional Art</option>
                            <option value="mixed-media">Mixed Media</option>
                            <option value="photography">Photography</option>
                            <option value="sculpture">Sculpture</option>
                            <option value="textile">Textile Art</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label>Category:</label>
                        <select id="quickCategory">
                            <option value="daily-prompt">Daily Prompt Response</option>
                            <option value="personal">Personal Work</option>
                            <option value="commission">Commission Work</option>
                            <option value="study">Study/Practice</option>
                            <option value="collaboration">Collaboration</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label>Upload Image*:</label>
                        <input type="file" id="quickImageFile" accept="image/*" required>
                    </div>
                    <div class="action-buttons">
                        <button type="submit" class="btn btn-save">Add to Showcase</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Pending Submissions Section -->
        <div class="admin-section">
            <h2 class="section-title">Pending Submissions</h2>
            <div id="pendingSubmissions">
                <p style="text-align: center; color: #999; font-style: italic;">
                    No pending submissions at the moment.<br>
                    <small>Submissions from the community form will appear here for review.</small>
                </p>
            </div>
        </div>

        <!-- Current Showcase Management -->
        <div class="admin-section">
            <h2 class="section-title">Current Showcase</h2>
            <div id="currentShowcase">
                <p style="text-align: center; color: #999; font-style: italic;">
                    Loading current showcase items...
                </p>
            </div>
        </div>
    </div>

    <script>
        // Initialize admin panel
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrentShowcase();
            
            // Handle quick add form
            document.getElementById('quickAddForm').addEventListener('submit', handleQuickAdd);
            
            // Handle API test form
            document.getElementById('apiTestForm').addEventListener('submit', handleAPITest);
        });

        // API Management Functions
        async function testAPI() {
            try {
                const response = await fetch('../api/test.php');
                const data = await response.json();
                
                document.getElementById('apiResults').style.display = 'block';
                document.getElementById('apiResponseText').textContent = JSON.stringify(data, null, 2);
                
                if (response.ok) {
                    showNotification('✅ API is working correctly!');
                } else {
                    showNotification('⚠️ API test returned errors', 'error');
                }
            } catch (error) {
                showNotification('❌ API connection failed: ' + error.message, 'error');
                document.getElementById('apiResults').style.display = 'block';
                document.getElementById('apiResponseText').textContent = 'Error: ' + error.message;
            }
        }

        async function viewApprovedArtworks() {
            try {
                const response = await fetch('../data/approved_artworks.json');
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('apiResults').style.display = 'block';
                    document.getElementById('apiResponseText').textContent = JSON.stringify(data, null, 2);
                    showNotification(`Found ${data.length} approved artworks`);
                } else {
                    throw new Error('No approved artworks file found');
                }
            } catch (error) {
                showNotification('No approved artworks yet or error loading', 'error');
                document.getElementById('apiResults').style.display = 'block';
                document.getElementById('apiResponseText').textContent = 'No approved artworks file found yet.';
            }
        }

        async function viewAPILogs() {
            try {
                const response = await fetch('../data/api_log.txt');
                if (response.ok) {
                    const logs = await response.text();
                    document.getElementById('apiResults').style.display = 'block';
                    document.getElementById('apiResponseText').textContent = logs || 'No API activity logged yet.';
                    showNotification('API logs loaded');
                } else {
                    throw new Error('No log file found');
                }
            } catch (error) {
                showNotification('No API logs yet or error loading', 'error');
                document.getElementById('apiResults').style.display = 'block';
                document.getElementById('apiResponseText').textContent = 'No API logs found yet.';
            }
        }

        function refreshCommunityShowcase() {
            // Open community page and trigger refresh
            const communityWindow = window.open('../community/', '_blank');
            
            // Try to trigger refresh if same origin
            setTimeout(() => {
                try {
                    if (communityWindow && communityWindow.refreshApprovedArtworks) {
                        communityWindow.refreshApprovedArtworks();
                    }
                } catch (e) {
                    console.log('Could not auto-refresh community page');
                }
            }, 1000);
            
            showNotification('🔄 Community page opened - approved artworks will refresh');
        }

        async function handleAPITest(event) {
            event.preventDefault();
            
            const apiData = {
                artist_name: document.getElementById('apiArtistName').value,
                artwork_title: document.getElementById('apiArtworkTitle').value,
                description: document.getElementById('apiDescription').value,
                medium: document.getElementById('apiMedium').value,
                category: document.getElementById('apiCategory').value,
                image_url: document.getElementById('apiImageUrl').value
            };
            
            try {
                const response = await fetch('../api/add-artwork.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'lcstudios_api_2025_secure' // Replace with your actual API key
                    },
                    body: JSON.stringify(apiData)
                });
                
                const result = await response.json();
                
                document.getElementById('apiResults').style.display = 'block';
                document.getElementById('apiResponseText').textContent = JSON.stringify(result, null, 2);
                
                if (response.ok) {
                    showNotification('✅ API test successful! Artwork added via API.');
                    document.getElementById('apiTestForm').reset();
                    
                    // Refresh community page
                    setTimeout(() => refreshCommunityShowcase(), 1000);
                } else {
                    showNotification('❌ API test failed: ' + result.error, 'error');
                }
            } catch (error) {
                showNotification('❌ API test error: ' + error.message, 'error');
                document.getElementById('apiResults').style.display = 'block';
                document.getElementById('apiResponseText').textContent = 'Error: ' + error.message;
            }
        }

        function handleQuickAdd(event) {
            event.preventDefault();
            
            const artistName = document.getElementById('quickArtistName').value;
            const artworkTitle = document.getElementById('quickArtworkTitle').value;
            const description = document.getElementById('quickDescription').value;
            const medium = document.getElementById('quickMedium').value;
            const category = document.getElementById('quickCategory').value;
            const imageFile = document.getElementById('quickImageFile').files[0];
            
            if (!artistName || !artworkTitle || !imageFile) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            // Create artwork data
            const artworkData = {
                id: 'admin-' + Date.now(),
                artistName: artistName,
                title: artworkTitle,
                description: description,
                medium: medium,
                category: category,
                dateAdded: new Date().toISOString().split('T')[0],
                likes: 0,
                status: 'approved'
            };
            
            // Process image and add to showcase
            const reader = new FileReader();
            reader.onload = function(e) {
                artworkData.imageUrl = e.target.result;
                addToMainShowcase(artworkData);
                showNotification('Artwork added successfully!');
                document.getElementById('quickAddForm').reset();
            };
            reader.readAsDataURL(imageFile);
        }

        function addToMainShowcase(artworkData) {
            // Store the artwork data for the community page to pick up
            localStorage.setItem('pendingApprovalArtwork', JSON.stringify(artworkData));
            
            // Open community page in new tab
            const communityWindow = window.open('../community/', '_blank');
            
            // Alternative: provide manual instructions
            showNotification('Artwork queued for addition! Refresh the community page to see it.');
            
            console.log('Artwork queued for addition:', artworkData);
        }

        function getCategoryTag(category) {
            const tags = {
                'daily-prompt': 'Daily Prompt',
                'personal': 'Personal Work',
                'commission': 'Commission',
                'study': 'Study',
                'collaboration': 'Collaboration',
                'other': 'Community Art'
            };
            return tags[category] || 'Community Art';
        }

        function loadCurrentShowcase() {
            // This would typically load from your current showcase
            // For now, we'll show a placeholder
            document.getElementById('currentShowcase').innerHTML = `
                <p style="text-align: center; color: #999;">
                    <strong>Showcase Management</strong><br>
                    Currently managing artwork from the main community page.<br>
                    <a href="../community/" target="_blank" style="color: var(--color-accent);">View Live Showcase →</a>
                </p>
            `;
        }

        function showNotification(message, type = 'success') {
            // Remove existing notification
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();
            
            // Create new notification
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            
            if (type === 'error') {
                notification.style.background = '#dc3545';
                notification.style.color = 'white';
            }
            
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Hide notification after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Auto-refresh every 30 seconds to check for new submissions
        setInterval(() => {
            // In a real implementation, this would check for new submissions
            console.log('Checking for new submissions...');
        }, 30000);
    </script>
</body>
</html>
